# SOME DESCRIPTIVE TITLE.
# Copyright (C) 2022, The QEMU Project Developers
# This file is distributed under the same license as the QEMU package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: QEMU 7.1\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-10-28 10:02+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: ../../../devel/testing.rst:4
msgid "Testing in QEMU"
msgstr ""

#: ../../../devel/testing.rst:6
msgid "This document describes the testing infrastructure in QEMU."
msgstr ""

#: ../../../devel/testing.rst:9
msgid "Testing with \"make check\""
msgstr ""

#: ../../../devel/testing.rst:11
msgid ""
"The \"make check\" testing family includes most of the C based tests in "
"QEMU. For a quick help, run ``make check-help`` from the source tree."
msgstr ""

#: ../../../devel/testing.rst:14
msgid "The usual way to run these tests is:"
msgstr ""

#: ../../../devel/testing.rst:16
msgid "make check"
msgstr ""

#: ../../../devel/testing.rst:20
msgid ""
"which includes QAPI schema tests, unit tests, QTests and some iotests. "
"Different sub-types of \"make check\" tests will be explained below."
msgstr ""

#: ../../../devel/testing.rst:23
msgid ""
"Before running tests, it is best to build QEMU programs first. Some tests "
"expect the executables to exist and will fail with obscure messages if they "
"cannot find them."
msgstr ""

#: ../../../devel/testing.rst:28
msgid "Unit tests"
msgstr ""

#: ../../../devel/testing.rst:30
msgid ""
"Unit tests, which can be invoked with ``make check-unit``, are simple C "
"tests that typically link to individual QEMU object files and exercise them "
"by calling exported functions."
msgstr ""

#: ../../../devel/testing.rst:34
msgid ""
"If you are writing new code in QEMU, consider adding a unit test, especially "
"for utility modules that are relatively stateless or have few dependencies. "
"To add a new unit test:"
msgstr ""

#: ../../../devel/testing.rst:38
msgid "Create a new source file. For example, ``tests/unit/foo-test.c``."
msgstr ""

#: ../../../devel/testing.rst:40
msgid ""
"Write the test. Normally you would include the header file which exports the "
"module API, then verify the interface behaves as expected from your test. "
"The test code should be organized with the glib testing framework. Copying "
"and modifying an existing test is usually a good idea."
msgstr ""

#: ../../../devel/testing.rst:45
msgid ""
"Add the test to ``tests/unit/meson.build``. The unit tests are listed in a "
"dictionary called ``tests``.  The values are any additional sources and "
"dependencies to be linked with the test.  For a simple test whose source is "
"in ``tests/unit/foo-test.c``, it is enough to add an entry like::"
msgstr ""

#: ../../../devel/testing.rst:50
msgid ""
"{\n"
"  ...\n"
"  'foo-test': [],\n"
"  ...\n"
"}"
msgstr ""

#: ../../../devel/testing.rst:56
msgid ""
"Since unit tests don't require environment variables, the simplest way to "
"debug a unit test failure is often directly invoking it or even running it "
"under ``gdb``. However there can still be differences in behavior between "
"``make`` invocations and your manual run, due to ``$MALLOC_PERTURB_`` "
"environment variable (which affects memory reclamation and catches invalid "
"pointers better) and gtester options. If necessary, you can run"
msgstr ""

#: ../../../devel/testing.rst:63
msgid "make check-unit V=1"
msgstr ""

#: ../../../devel/testing.rst:67
msgid ""
"and copy the actual command line which executes the unit test, then run it "
"from the command line."
msgstr ""

#: ../../../devel/testing.rst:71
msgid "QTest"
msgstr ""

#: ../../../devel/testing.rst:73
msgid ""
"QTest is a device emulation testing framework.  It can be very useful to "
"test device models; it could also control certain aspects of QEMU (such as "
"virtual clock stepping), with a special purpose \"qtest\" protocol.  Refer "
"to :doc:`qtest` for more details."
msgstr ""

#: ../../../devel/testing.rst:78
msgid "QTest cases can be executed with"
msgstr ""

#: ../../../devel/testing.rst:80
msgid "make check-qtest"
msgstr ""

#: ../../../devel/testing.rst:85
msgid "QAPI schema tests"
msgstr ""

#: ../../../devel/testing.rst:87
msgid ""
"The QAPI schema tests validate the QAPI parser used by QMP, by feeding "
"predefined input to the parser and comparing the result with the reference "
"output."
msgstr ""

#: ../../../devel/testing.rst:91
msgid ""
"The input/output data is managed under the ``tests/qapi-schema`` directory. "
"Each test case includes four files that have a common base name:"
msgstr ""

#: ../../../devel/testing.rst:94
msgid ""
"``${casename}.json`` - the file contains the JSON input for feeding the "
"parser"
msgstr ""

#: ../../../devel/testing.rst:96
msgid ""
"``${casename}.out`` - the file contains the expected stdout from the parser"
msgstr ""

#: ../../../devel/testing.rst:97
msgid ""
"``${casename}.err`` - the file contains the expected stderr from the parser"
msgstr ""

#: ../../../devel/testing.rst:98
msgid "``${casename}.exit`` - the expected error code"
msgstr ""

#: ../../../devel/testing.rst:100
msgid ""
"Consider adding a new QAPI schema test when you are making a change on the "
"QAPI parser (either fixing a bug or extending/modifying the syntax). To do "
"this:"
msgstr ""

#: ../../../devel/testing.rst:103
msgid "Add four files for the new case as explained above. For example:"
msgstr ""

#: ../../../devel/testing.rst:105
msgid "``$EDITOR tests/qapi-schema/foo.{json,out,err,exit}``."
msgstr ""

#: ../../../devel/testing.rst:107
msgid "Add the new test in ``tests/Makefile.include``. For example:"
msgstr ""

#: ../../../devel/testing.rst:109
msgid "``qapi-schema += foo.json``"
msgstr ""

#: ../../../devel/testing.rst:112
msgid "check-block"
msgstr ""

#: ../../../devel/testing.rst:114
msgid ""
"``make check-block`` runs a subset of the block layer iotests (the tests "
"that are in the \"auto\" group). See the \"QEMU iotests\" section below for "
"more information."
msgstr ""

#: ../../../devel/testing.rst:119
msgid "QEMU iotests"
msgstr ""

#: ../../../devel/testing.rst:121
msgid ""
"QEMU iotests, under the directory ``tests/qemu-iotests``, is the testing "
"framework widely used to test block layer related features. It is higher "
"level than \"make check\" tests and 99% of the code is written in bash or "
"Python scripts.  The testing success criteria is golden output comparison, "
"and the test files are named with numbers."
msgstr ""

#: ../../../devel/testing.rst:127
msgid ""
"To run iotests, make sure QEMU is built successfully, then switch to the "
"``tests/qemu-iotests`` directory under the build directory, and run ``./"
"check`` with desired arguments from there."
msgstr ""

#: ../../../devel/testing.rst:131
msgid ""
"By default, \"raw\" format and \"file\" protocol is used; all tests will be "
"executed, except the unsupported ones. You can override the format and "
"protocol with arguments:"
msgstr ""

#: ../../../devel/testing.rst:135
msgid ""
"# test with qcow2 format\n"
"./check -qcow2\n"
"# or test a different protocol\n"
"./check -nbd"
msgstr ""

#: ../../../devel/testing.rst:142
msgid "It's also possible to list test numbers explicitly:"
msgstr ""

#: ../../../devel/testing.rst:144
msgid ""
"# run selected cases with qcow2 format\n"
"./check -qcow2 001 030 153"
msgstr ""

#: ../../../devel/testing.rst:149
msgid ""
"Cache mode can be selected with the \"-c\" option, which may help reveal "
"bugs that are specific to certain cache mode."
msgstr ""

#: ../../../devel/testing.rst:152
msgid ""
"More options are supported by the ``./check`` script, run ``./check -h`` for "
"help."
msgstr ""

#: ../../../devel/testing.rst:156
msgid "Writing a new test case"
msgstr ""

#: ../../../devel/testing.rst:158
msgid ""
"Consider writing a tests case when you are making any changes to the block "
"layer. An iotest case is usually the choice for that. There are already many "
"test cases, so it is possible that extending one of them may achieve the "
"goal and save the boilerplate to create one.  (Unfortunately, there isn't a "
"100% reliable way to find a related one out of hundreds of tests.  One "
"approach is using ``git grep``.)"
msgstr ""

#: ../../../devel/testing.rst:165
msgid ""
"Usually an iotest case consists of two files. One is an executable that "
"produces output to stdout and stderr, the other is the expected reference "
"output. They are given the same number in file names. E.g. Test script "
"``055`` and reference output ``055.out``."
msgstr ""

#: ../../../devel/testing.rst:170
msgid ""
"In rare cases, when outputs differ between cache mode ``none`` and others, a "
"``.out.nocache`` file is added. In other cases, when outputs differ between "
"image formats, more than one ``.out`` files are created ending with the "
"respective format names, e.g. ``178.out.qcow2`` and ``178.out.raw``."
msgstr ""

#: ../../../devel/testing.rst:175
msgid ""
"There isn't a hard rule about how to write a test script, but a new test is "
"usually a (copy and) modification of an existing case.  There are a few "
"commonly used ways to create a test:"
msgstr ""

#: ../../../devel/testing.rst:179
msgid ""
"A Bash script. It will make use of several environmental variables related "
"to the testing procedure, and could source a group of ``common.*`` libraries "
"for some common helper routines."
msgstr ""

#: ../../../devel/testing.rst:183
msgid ""
"A Python unittest script. Import ``iotests`` and create a subclass of "
"``iotests.QMPTestCase``, then call ``iotests.main`` method. The downside of "
"this approach is that the output is too scarce, and the script is considered "
"harder to debug."
msgstr ""

#: ../../../devel/testing.rst:188
msgid ""
"A simple Python script without using unittest module. This could also import "
"``iotests`` for launching QEMU and utilities etc, but it doesn't inherit "
"from ``iotests.QMPTestCase`` therefore doesn't use the Python unittest "
"execution. This is a combination of 1 and 2."
msgstr ""

#: ../../../devel/testing.rst:193
msgid ""
"Pick the language per your preference since both Bash and Python have "
"comparable library support for invoking and interacting with QEMU programs. "
"If you opt for Python, it is strongly recommended to write Python 3 "
"compatible code."
msgstr ""

#: ../../../devel/testing.rst:198
msgid ""
"Both Python and Bash frameworks in iotests provide helpers to manage test "
"images. They can be used to create and clean up images under the test "
"directory. If no I/O or any protocol specific feature is needed, it is often "
"more convenient to use the pseudo block driver, ``null-co://``, as the test "
"image, which doesn't require image creation or cleaning up. Avoid system-"
"wide devices or files whenever possible, such as ``/dev/null`` or ``/dev/"
"zero``. Otherwise, image locking implications have to be considered.  For "
"example, another application on the host may have locked the file, possibly "
"leading to a test failure.  If using such devices are explicitly desired, "
"consider adding ``locking=off`` option to disable image locking."
msgstr ""

#: ../../../devel/testing.rst:210
msgid "Debugging a test case"
msgstr ""

#: ../../../devel/testing.rst:212
msgid ""
"The following options to the ``check`` script can be useful when debugging a "
"failing test:"
msgstr ""

#: ../../../devel/testing.rst:215
msgid ""
"``-gdb`` wraps every QEMU invocation in a ``gdbserver``, which waits for a "
"connection from a gdb client.  The options given to ``gdbserver`` (e.g. the "
"address on which to listen for connections) are taken from the "
"``$GDB_OPTIONS`` environment variable.  By default (if ``$GDB_OPTIONS`` is "
"empty), it listens on ``localhost:12345``. It is possible to connect to it "
"for example with ``gdb -iex \"target remote $addr\"``, where ``$addr`` is "
"the address ``gdbserver`` listens on. If the ``-gdb`` option is not used, "
"``$GDB_OPTIONS`` is ignored, regardless of whether it is set or not."
msgstr ""

#: ../../../devel/testing.rst:226
msgid ""
"``-valgrind`` attaches a valgrind instance to QEMU. If it detects warnings, "
"it will print and save the log in ``$TEST_DIR/<valgrind_pid>.valgrind``. The "
"final command line will be ``valgrind --log-file=$TEST_DIR/ <valgrind_pid>."
"valgrind --error-exitcode=99 $QEMU ...``"
msgstr ""

#: ../../../devel/testing.rst:232
msgid ""
"``-d`` (debug) just increases the logging verbosity, showing for example the "
"QMP commands and answers."
msgstr ""

#: ../../../devel/testing.rst:235
msgid ""
"``-p`` (print) redirects QEMUâ€™s stdout and stderr to the test output, "
"instead of saving it into a log file in ``$TEST_DIR/qemu-machine-"
"<random_string>``."
msgstr ""

#: ../../../devel/testing.rst:240
msgid "Test case groups"
msgstr ""

#: ../../../devel/testing.rst:242
msgid ""
"\"Tests may belong to one or more test groups, which are defined in the form "
"of a comment in the test source file. By convention, test groups are listed "
"in the second line of the test file, after the \"#!/...\" line, like this:"
msgstr ""

#: ../../../devel/testing.rst:246
msgid ""
"#!/usr/bin/env python3\n"
"# group: auto quick\n"
"#\n"
"..."
msgstr ""

#: ../../../devel/testing.rst:253
msgid ""
"Another way of defining groups is creating the tests/qemu-iotests/group."
"local file. This should be used only for downstream (this file should never "
"appear in upstream). This file may be used for defining some downstream test "
"groups or for temporarily disabling tests, like this:"
msgstr ""

#: ../../../devel/testing.rst:258
msgid ""
"# groups for some company downstream process\n"
"#\n"
"# ci - tests to run on build\n"
"# down - our downstream tests, not for upstream\n"
"#\n"
"# Format of each line is:\n"
"# TEST_NAME TEST_GROUP [TEST_GROUP ]...\n"
"\n"
"013 ci\n"
"210 disabled\n"
"215 disabled\n"
"our-ugly-workaround-test down ci"
msgstr ""

#: ../../../devel/testing.rst:273
msgid "Note that the following group names have a special meaning:"
msgstr ""

#: ../../../devel/testing.rst:275
msgid "quick: Tests in this group should finish within a few seconds."
msgstr ""

#: ../../../devel/testing.rst:277
msgid ""
"auto: Tests in this group are used during \"make check\" and should be "
"runnable in any case. That means they should run with every QEMU binary "
"(also non-x86), with every QEMU configuration (i.e. must not fail if an "
"optional feature is not compiled in - but reporting a \"skip\" is ok), work "
"at least with the qcow2 file format, work with all kind of host filesystems "
"and users (e.g. \"nobody\" or \"root\") and must not take too much memory "
"and disk space (since CI pipelines tend to fail otherwise)."
msgstr ""

#: ../../../devel/testing.rst:285
msgid "disabled: Tests in this group are disabled and ignored by check."
msgstr ""

#: ../../../devel/testing.rst:290
msgid "Container based tests"
msgstr ""

#: ../../../devel/testing.rst:293
msgid "Introduction"
msgstr ""

#: ../../../devel/testing.rst:295
msgid ""
"The container testing framework in QEMU utilizes public images to build and "
"test QEMU in predefined and widely accessible Linux environments. This makes "
"it possible to expand the test coverage across distros, toolchain flavors "
"and library versions. The support was originally written for Docker although "
"we also support Podman as an alternative container runtime. Although the "
"many of the target names and scripts are prefixed with \"docker\" the system "
"will automatically run on whichever is configured."
msgstr ""

#: ../../../devel/testing.rst:304
msgid ""
"The container images are also used to augment the generation of tests for "
"testing TCG. See :ref:`checktcg-ref` for more details."
msgstr ""

#: ../../../devel/testing.rst:308
msgid "Docker Prerequisites"
msgstr ""

#: ../../../devel/testing.rst:310
msgid ""
"Install \"docker\" with the system package manager and start the Docker "
"service on your development machine, then make sure you have the privilege "
"to run Docker commands. Typically it means setting up passwordless ``sudo "
"docker`` command or login as root. For example:"
msgstr ""

#: ../../../devel/testing.rst:315
msgid ""
"$ sudo yum install docker\n"
"$ # or `apt-get install docker` for Ubuntu, etc.\n"
"$ sudo systemctl start docker\n"
"$ sudo docker ps"
msgstr ""

#: ../../../devel/testing.rst:322 ../../../devel/testing.rst:348
msgid ""
"The last command should print an empty table, to verify the system is ready."
msgstr ""

#: ../../../devel/testing.rst:324
msgid ""
"An alternative method to set up permissions is by adding the current user to "
"\"docker\" group and making the docker daemon socket file (by default ``/var/"
"run/docker.sock``) accessible to the group:"
msgstr ""

#: ../../../devel/testing.rst:328
msgid ""
"$ sudo groupadd docker\n"
"$ sudo usermod $USER -a -G docker\n"
"$ sudo chown :docker /var/run/docker.sock"
msgstr ""

#: ../../../devel/testing.rst:334
msgid ""
"Note that any one of above configurations makes it possible for the user to "
"exploit the whole host with Docker bind mounting or other privileged "
"operations.  So only do it on development machines."
msgstr ""

#: ../../../devel/testing.rst:339
msgid "Podman Prerequisites"
msgstr ""

#: ../../../devel/testing.rst:341
msgid "Install \"podman\" with the system package manager."
msgstr ""

#: ../../../devel/testing.rst:343
msgid ""
"$ sudo dnf install podman\n"
"$ podman ps"
msgstr ""

#: ../../../devel/testing.rst:351 ../../../devel/testing.rst:688
msgid "Quickstart"
msgstr ""

#: ../../../devel/testing.rst:353
msgid ""
"From source tree, type ``make docker-help`` to see the help. Testing can be "
"started without configuring or building QEMU (``configure`` and ``make`` are "
"done in the container, with parameters defined by the make target):"
msgstr ""

#: ../../../devel/testing.rst:358
msgid "make docker-test-build@centos8"
msgstr ""

#: ../../../devel/testing.rst:362
msgid ""
"This will create a container instance using the ``centos8`` image (the image "
"is downloaded and initialized automatically), in which the ``test-build`` "
"job is executed."
msgstr ""

#: ../../../devel/testing.rst:367
msgid "Registry"
msgstr ""

#: ../../../devel/testing.rst:369
msgid ""
"The QEMU project has a container registry hosted by GitLab at ``registry."
"gitlab.com/qemu-project/qemu`` which will automatically be used to pull in "
"pre-built layers. This avoids unnecessary strain on the distro archives "
"created by multiple developers running the same container build steps over "
"and over again. This can be overridden locally by using the ``NOCACHE`` "
"build option:"
msgstr ""

#: ../../../devel/testing.rst:376
msgid "make docker-image-debian10 NOCACHE=1"
msgstr ""

#: ../../../devel/testing.rst:381
msgid "Images"
msgstr ""

#: ../../../devel/testing.rst:383
msgid ""
"Along with many other images, the ``centos8`` image is defined in a "
"Dockerfile in ``tests/docker/dockerfiles/``, called ``centos8.docker``. "
"``make docker-help`` command will list all the available images."
msgstr ""

#: ../../../devel/testing.rst:387
msgid ""
"A ``.pre`` script can be added beside the ``.docker`` file, which will be "
"executed before building the image under the build context directory. This "
"is mainly used to do necessary host side setup. One such setup is "
"``binfmt_misc``, for example, to make qemu-user powered cross build "
"containers work."
msgstr ""

#: ../../../devel/testing.rst:392
msgid ""
"Most of the existing Dockerfiles were written by hand, simply by creating a "
"a new ``.docker`` file under the ``tests/docker/dockerfiles/`` directory. "
"This has led to an inconsistent set of packages being present across the "
"different containers."
msgstr ""

#: ../../../devel/testing.rst:397
msgid ""
"Thus going forward, QEMU is aiming to automatically generate the Dockerfiles "
"using the ``lcitool`` program provided by the ``libvirt-ci`` project:"
msgstr ""

#: ../../../devel/testing.rst:400
msgid "https://gitlab.com/libvirt/libvirt-ci"
msgstr ""

#: ../../../devel/testing.rst:402
msgid ""
"In that project, there is a ``mappings.yml`` file defining the distro native "
"package names for a wide variety of third party projects. This is processed "
"in combination with a project defined list of build pre-requisites to "
"determine the list of native packages to install on each distribution. This "
"can be used to generate dockerfiles, VM package lists and Cirrus CI "
"variables needed to setup build environments across OS distributions with a "
"consistent set of packages present."
msgstr ""

#: ../../../devel/testing.rst:410
msgid ""
"When preparing a patch series that adds a new build pre-requisite to QEMU, "
"updates to various lcitool data files may be required."
msgstr ""

#: ../../../devel/testing.rst:415
msgid "Adding new build pre-requisites"
msgstr ""

#: ../../../devel/testing.rst:417
msgid ""
"In the simple case where the pre-requisite is already known to ``libvirt-"
"ci`` the following steps are needed"
msgstr ""

#: ../../../devel/testing.rst:420
msgid "Edit ``tests/lcitool/projects/qemu.yml`` and add the pre-requisite"
msgstr ""

#: ../../../devel/testing.rst:422
msgid ""
"Run ``make lcitool-refresh`` to re-generate all relevant build environment "
"manifests"
msgstr ""

#: ../../../devel/testing.rst:425
msgid ""
"In some cases ``libvirt-ci`` will not know about the build pre-requisite and "
"thus some extra preparation steps will be required first"
msgstr ""

#: ../../../devel/testing.rst:428 ../../../devel/testing.rst:469
msgid "Fork the ``libvirt-ci`` project on gitlab"
msgstr ""

#: ../../../devel/testing.rst:430
msgid ""
"Edit the ``mappings.yml`` change to add an entry for the new build "
"prerequisite, listing its native package name on as many OS distros as "
"practical."
msgstr ""

#: ../../../devel/testing.rst:434 ../../../devel/testing.rst:480
msgid ""
"Commit the ``mappings.yml`` change and submit a merge request to the "
"``libvirt-ci`` project, noting in the description that this is a new build "
"pre-requisite desired for use with QEMU"
msgstr ""

#: ../../../devel/testing.rst:438 ../../../devel/testing.rst:484
msgid ""
"CI pipeline will run to validate that the changes to ``mappings.yml`` are "
"correct, by attempting to install the newly listed package on all OS "
"distributions supported by ``libvirt-ci``."
msgstr ""

#: ../../../devel/testing.rst:442 ../../../devel/testing.rst:488
msgid ""
"Once the merge request is accepted, go back to QEMU and update the ``libvirt-"
"ci`` submodule to point to a commit that contains the ``mappings.yml`` "
"update."
msgstr ""

#: ../../../devel/testing.rst:448
msgid "Adding new OS distros"
msgstr ""

#: ../../../devel/testing.rst:450
msgid ""
"In some cases ``libvirt-ci`` will not know about the OS distro that is "
"desired to be tested. Before adding a new OS distro, discuss the proposed "
"addition:"
msgstr ""

#: ../../../devel/testing.rst:454
msgid ""
"Send a mail to qemu-devel, copying people listed in the MAINTAINERS file for "
"``Build and test automation``."
msgstr ""

#: ../../../devel/testing.rst:457
msgid ""
"There are limited CI compute resources available to QEMU, so the cost/"
"benefit tradeoff of adding new OS distros needs to be considered."
msgstr ""

#: ../../../devel/testing.rst:460
msgid ""
"File an issue at https://gitlab.com/libvirt/libvirt-ci/-/issues pointing to "
"the qemu-devel mail thread in the archives."
msgstr ""

#: ../../../devel/testing.rst:463
msgid ""
"This alerts other people who might be interested in the work to avoid "
"duplication, as well as to get feedback from libvirt-ci maintainers on any "
"tips to ease the addition"
msgstr ""

#: ../../../devel/testing.rst:467
msgid "Assuming there is agreement to add a new OS distro then"
msgstr ""

#: ../../../devel/testing.rst:471
msgid ""
"Add metadata under ``guests/lcitool/lcitool/ansible/group_vars/`` for the "
"new OS distro. There might be code changes required if the OS distro uses a "
"package format not currently known. The ``libvirt-ci`` maintainers can "
"advise on this when the issue is file."
msgstr ""

#: ../../../devel/testing.rst:477
msgid ""
"Edit the ``mappings.yml`` change to update all the existing package entries, "
"providing details of the new OS distro"
msgstr ""

#: ../../../devel/testing.rst:494
msgid "Tests"
msgstr ""

#: ../../../devel/testing.rst:496
msgid ""
"Different tests are added to cover various configurations to build and test "
"QEMU.  Docker tests are the executables under ``tests/docker`` named ``test-"
"*``. They are typically shell scripts and are built on top of a shell "
"library, ``tests/docker/common.rc``, which provides helpers to find the QEMU "
"source and build it."
msgstr ""

#: ../../../devel/testing.rst:502
msgid "The full list of tests is printed in the ``make docker-help`` help."
msgstr ""

#: ../../../devel/testing.rst:505
msgid "Debugging a Docker test failure"
msgstr ""

#: ../../../devel/testing.rst:507
msgid ""
"When CI tasks, maintainers or yourself report a Docker test failure, follow "
"the below steps to debug it:"
msgstr ""

#: ../../../devel/testing.rst:510
msgid ""
"Locally reproduce the failure with the reported command line. E.g. run "
"``make docker-test-mingw@fedora J=8``."
msgstr ""

#: ../../../devel/testing.rst:512
msgid "Add \"V=1\" to the command line, try again, to see the verbose output."
msgstr ""

#: ../../../devel/testing.rst:513
msgid ""
"Further add \"DEBUG=1\" to the command line. This will pause in a shell "
"prompt in the container right before testing starts. You could either "
"manually build QEMU and run tests from there, or press Ctrl-D to let the "
"Docker testing continue."
msgstr ""

#: ../../../devel/testing.rst:517
msgid ""
"If you press Ctrl-D, the same building and testing procedure will begin, and "
"will hopefully run into the error again. After that, you will be dropped to "
"the prompt for debug."
msgstr ""

#: ../../../devel/testing.rst:522
msgid "Options"
msgstr ""

#: ../../../devel/testing.rst:524
msgid ""
"Various options can be used to affect how Docker tests are done. The full "
"list is in the ``make docker`` help text. The frequently used ones are:"
msgstr ""

#: ../../../devel/testing.rst:527
msgid ""
"``V=1``: the same as in top level ``make``. It will be propagated to the "
"container and enable verbose output."
msgstr ""

#: ../../../devel/testing.rst:529
msgid ""
"``J=$N``: the number of parallel tasks in make commands in the container, "
"similar to the ``-j $N`` option in top level ``make``. (The ``-j`` option in "
"top level ``make`` will not be propagated into the container.)"
msgstr ""

#: ../../../devel/testing.rst:532
msgid ""
"``DEBUG=1``: enables debug. See the previous \"Debugging a Docker test "
"failure\" section."
msgstr ""

#: ../../../devel/testing.rst:536
msgid "Thread Sanitizer"
msgstr ""

#: ../../../devel/testing.rst:538
msgid ""
"Thread Sanitizer (TSan) is a tool which can detect data races.  QEMU "
"supports building and testing with this tool."
msgstr ""

#: ../../../devel/testing.rst:541
msgid "For more information on TSan:"
msgstr ""

#: ../../../devel/testing.rst:543
msgid "https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual"
msgstr ""

#: ../../../devel/testing.rst:546
msgid "Thread Sanitizer in Docker"
msgstr ""

#: ../../../devel/testing.rst:547
msgid "TSan is currently supported in the ubuntu2004 docker."
msgstr ""

#: ../../../devel/testing.rst:549
msgid "The test-tsan test will build using TSan and then run make check."
msgstr ""

#: ../../../devel/testing.rst:551
msgid "make docker-test-tsan@ubuntu2004"
msgstr ""

#: ../../../devel/testing.rst:555
msgid "TSan warnings under docker are placed in files located at build/tsan/."
msgstr ""

#: ../../../devel/testing.rst:557
msgid ""
"We recommend using DEBUG=1 to allow launching the test from inside the "
"docker, and to allow review of the warnings generated by TSan."
msgstr ""

#: ../../../devel/testing.rst:561
msgid "Building and Testing with TSan"
msgstr ""

#: ../../../devel/testing.rst:563
msgid ""
"It is possible to build and test with TSan, with a few additional steps. "
"These steps are normally done automatically in the docker."
msgstr ""

#: ../../../devel/testing.rst:566
msgid "There is a one time patch needed in clang-9 or clang-10 at this time:"
msgstr ""

#: ../../../devel/testing.rst:568
msgid ""
"sed -i 's/^const/static const/g' \\\n"
"    /usr/lib/llvm-10/lib/clang/10.0.0/include/sanitizer/tsan_interface.h"
msgstr ""

#: ../../../devel/testing.rst:573
msgid "To configure the build for TSan:"
msgstr ""

#: ../../../devel/testing.rst:575
msgid ""
"../configure --enable-tsan --cc=clang-10 --cxx=clang++-10 \\\n"
"             --disable-werror --extra-cflags=\"-O0\""
msgstr ""

#: ../../../devel/testing.rst:580
msgid ""
"The runtime behavior of TSAN is controlled by the TSAN_OPTIONS environment "
"variable."
msgstr ""

#: ../../../devel/testing.rst:583
msgid "More information on the TSAN_OPTIONS can be found here:"
msgstr ""

#: ../../../devel/testing.rst:585 ../../../devel/testing.rst:623
msgid "https://github.com/google/sanitizers/wiki/ThreadSanitizerFlags"
msgstr ""

#: ../../../devel/testing.rst:587
msgid "For example:"
msgstr ""

#: ../../../devel/testing.rst:589
msgid ""
"export TSAN_OPTIONS=suppressions=<path to qemu>/tests/tsan/suppressions.tsan "
"\\\n"
"                    detect_deadlocks=false history_size=7 exitcode=0 \\\n"
"                    log_path=<build path>/tsan/tsan_warning"
msgstr ""

#: ../../../devel/testing.rst:595
msgid ""
"The above exitcode=0 has TSan continue without error if any warnings are "
"found. This allows for running the test and then checking the warnings "
"afterwards. If you want TSan to stop and exit with error on warnings, use "
"exitcode=66."
msgstr ""

#: ../../../devel/testing.rst:600
msgid "TSan Suppressions"
msgstr ""

#: ../../../devel/testing.rst:601
msgid ""
"Keep in mind that for any data race warning, although there might be a data "
"race detected by TSan, there might be no actual bug here.  TSan provides "
"several different mechanisms for suppressing warnings.  In general it is "
"recommended to fix the code if possible to eliminate the data race rather "
"than suppress the warning."
msgstr ""

#: ../../../devel/testing.rst:607
msgid "A few important files for suppressing warnings are:"
msgstr ""

#: ../../../devel/testing.rst:609
msgid ""
"tests/tsan/suppressions.tsan - Has TSan warnings we wish to suppress at "
"runtime. The comment on each suppression will typically indicate why we are "
"suppressing it.  More information on the file format can be found here:"
msgstr ""

#: ../../../devel/testing.rst:613
msgid "https://github.com/google/sanitizers/wiki/ThreadSanitizerSuppressions"
msgstr ""

#: ../../../devel/testing.rst:615
msgid ""
"tests/tsan/blacklist.tsan - Has TSan warnings we wish to disable at compile "
"time for test or debug. Add flags to configure to enable:"
msgstr ""

#: ../../../devel/testing.rst:619
msgid ""
"\"--extra-cflags=-fsanitize-blacklist=<src path>/tests/tsan/blacklist.tsan\""
msgstr ""

#: ../../../devel/testing.rst:621
msgid ""
"More information on the file format can be found here under \"Blacklist "
"Format\":"
msgstr ""

#: ../../../devel/testing.rst:626
msgid "TSan Annotations"
msgstr ""

#: ../../../devel/testing.rst:627
msgid ""
"include/qemu/tsan.h defines annotations.  See this file for more "
"descriptions of the annotations themselves.  Annotations can be used to "
"suppress TSan warnings or give TSan more information so that it can detect "
"proper relationships between accesses of data."
msgstr ""

#: ../../../devel/testing.rst:632
msgid "Annotation examples can be found here:"
msgstr ""

#: ../../../devel/testing.rst:634
msgid "https://github.com/llvm/llvm-project/tree/master/compiler-rt/test/tsan/"
msgstr ""

#: ../../../devel/testing.rst:636
msgid ""
"Good files to start with are: annotate_happens_before.cpp and ignore_race.cpp"
msgstr ""

#: ../../../devel/testing.rst:638
msgid "The full set of annotations can be found here:"
msgstr ""

#: ../../../devel/testing.rst:640
msgid ""
"https://github.com/llvm/llvm-project/blob/master/compiler-rt/lib/tsan/rtl/"
"tsan_interface_ann.cpp"
msgstr ""

#: ../../../devel/testing.rst:643
msgid "docker-binfmt-image-debian-% targets"
msgstr ""

#: ../../../devel/testing.rst:645
msgid ""
"It is possible to combine Debian's bootstrap scripts with a configured "
"``binfmt_misc`` to bootstrap a number of Debian's distros including "
"experimental ports not yet supported by a released OS. This can simplify "
"setting up a rootfs by using docker to contain the foreign rootfs rather "
"than manually invoking chroot."
msgstr ""

#: ../../../devel/testing.rst:652
msgid "Setting up ``binfmt_misc``"
msgstr ""

#: ../../../devel/testing.rst:654
msgid ""
"You can use the script ``qemu-binfmt-conf.sh`` to configure a QEMU user "
"binary to automatically run binaries for the foreign architecture. While the "
"scripts will try their best to work with dynamically linked QEMU's a "
"statically linked one will present less potential complications when copying "
"into the docker image. Modern kernels support the ``F`` (fix binary) flag "
"which will open the QEMU executable on setup and avoids the need to find and "
"re-open in the chroot environment. This is triggered with the ``--"
"persistent`` flag."
msgstr ""

#: ../../../devel/testing.rst:664
msgid "Example invocation"
msgstr ""

#: ../../../devel/testing.rst:666
msgid "For example to setup the HPPA ports builds of Debian::"
msgstr ""

#: ../../../devel/testing.rst:668
msgid ""
"make docker-binfmt-image-debian-sid-hppa \\\n"
"  DEB_TYPE=sid DEB_ARCH=hppa \\\n"
"  DEB_URL=http://ftp.ports.debian.org/debian-ports/ \\\n"
"  DEB_KEYRING=/usr/share/keyrings/debian-ports-archive-keyring.gpg \\\n"
"  EXECUTABLE=(pwd)/qemu-hppa V=1"
msgstr ""

#: ../../../devel/testing.rst:674
msgid ""
"The ``DEB_`` variables are substitutions used by ``debian-boostrap.pre`` "
"which is called to do the initial debootstrap of the rootfs before it is "
"copied into the container. The second stage is run as part of the build. The "
"final image will be tagged as ``qemu/debian-sid-hppa``."
msgstr ""

#: ../../../devel/testing.rst:681
msgid "VM testing"
msgstr ""

#: ../../../devel/testing.rst:683
msgid ""
"This test suite contains scripts that bootstrap various guest images that "
"have necessary packages to build QEMU. The basic usage is documented in "
"``Makefile`` help which is displayed with ``make vm-help``."
msgstr ""

#: ../../../devel/testing.rst:690
msgid ""
"Run ``make vm-help`` to list available make targets. Invoke a specific make "
"command to run build test in an image. For example, ``make vm-build-"
"freebsd`` will build the source tree in the FreeBSD image. The command can "
"be executed from either the source tree or the build dir; if the former, ``./"
"configure`` is not needed. The command will then generate the test image in "
"``./tests/vm/`` under the working directory."
msgstr ""

#: ../../../devel/testing.rst:697
msgid ""
"Note: images created by the scripts accept a well-known RSA key pair for SSH "
"access, so they SHOULD NOT be exposed to external interfaces if you are "
"concerned about attackers taking control of the guest and potentially "
"exploiting a QEMU security bug to compromise the host."
msgstr ""

#: ../../../devel/testing.rst:703
msgid "QEMU binaries"
msgstr ""

#: ../../../devel/testing.rst:705
msgid ""
"By default, ``qemu-system-x86_64`` is searched in $PATH to run the guest. If "
"there isn't one, or if it is older than 2.10, the test won't work. In this "
"case, provide the QEMU binary in env var: ``QEMU=/path/to/qemu-2.10+``."
msgstr ""

#: ../../../devel/testing.rst:709
msgid ""
"Likewise the path to ``qemu-img`` can be set in QEMU_IMG environment "
"variable."
msgstr ""

#: ../../../devel/testing.rst:712
msgid "Make jobs"
msgstr ""

#: ../../../devel/testing.rst:714
msgid ""
"The ``-j$X`` option in the make command line is not propagated into the VM, "
"specify ``J=$X`` to control the make jobs in the guest."
msgstr ""

#: ../../../devel/testing.rst:718
msgid "Debugging"
msgstr ""

#: ../../../devel/testing.rst:720
msgid ""
"Add ``DEBUG=1`` and/or ``V=1`` to the make command to allow interactive "
"debugging and verbose output. If this is not enough, see the next section. "
"``V=1`` will be propagated down into the make jobs in the guest."
msgstr ""

#: ../../../devel/testing.rst:725
msgid "Manual invocation"
msgstr ""

#: ../../../devel/testing.rst:727
msgid ""
"Each guest script is an executable script with the same command line "
"options. For example to work with the netbsd guest, use ``$QEMU_SRC/tests/vm/"
"netbsd``:"
msgstr ""

#: ../../../devel/testing.rst:730
msgid ""
"$ cd $QEMU_SRC/tests/vm\n"
"\n"
"# To bootstrap the image\n"
"$ ./netbsd --build-image --image /var/tmp/netbsd.img\n"
"<...>\n"
"\n"
"# To run an arbitrary command in guest (the output will not be echoed "
"unless\n"
"# --debug is added)\n"
"$ ./netbsd --debug --image /var/tmp/netbsd.img uname -a\n"
"\n"
"# To build QEMU in guest\n"
"$ ./netbsd --debug --image /var/tmp/netbsd.img --build-qemu $QEMU_SRC\n"
"\n"
"# To get to an interactive shell\n"
"$ ./netbsd --interactive --image /var/tmp/netbsd.img sh"
msgstr ""

#: ../../../devel/testing.rst:749
msgid "Adding new guests"
msgstr ""

#: ../../../devel/testing.rst:751
msgid "Please look at existing guest scripts for how to add new guests."
msgstr ""

#: ../../../devel/testing.rst:753
msgid ""
"Most importantly, create a subclass of BaseVM and implement "
"``build_image()`` method and define ``BUILD_SCRIPT``, then finally call "
"``basevm.main()`` from the script's ``main()``."
msgstr ""

#: ../../../devel/testing.rst:757
msgid ""
"Usually in ``build_image()``, a template image is downloaded from a "
"predefined URL. ``BaseVM._download_with_cache()`` takes care of the cache "
"and the checksum, so consider using it."
msgstr ""

#: ../../../devel/testing.rst:761
msgid ""
"Once the image is downloaded, users, SSH server and QEMU build deps should "
"be set up:"
msgstr ""

#: ../../../devel/testing.rst:764
msgid "Root password set to ``BaseVM.ROOT_PASS``"
msgstr ""

#: ../../../devel/testing.rst:765
msgid ""
"User ``BaseVM.GUEST_USER`` is created, and password set to ``BaseVM."
"GUEST_PASS``"
msgstr ""

#: ../../../devel/testing.rst:767
msgid ""
"SSH service is enabled and started on boot, ``$QEMU_SRC/tests/keys/id_rsa."
"pub`` is added to ssh's ``authorized_keys`` file of both root and the normal "
"user"
msgstr ""

#: ../../../devel/testing.rst:770
msgid ""
"DHCP client service is enabled and started on boot, so that it can "
"automatically configure the virtio-net-pci NIC and communicate with QEMU "
"user net (10.0.2.2)"
msgstr ""

#: ../../../devel/testing.rst:773
msgid ""
"Necessary packages are installed to untar the source tarball and build QEMU"
msgstr ""

#: ../../../devel/testing.rst:776
msgid ""
"Write a proper ``BUILD_SCRIPT`` template, which should be a shell script "
"that untars a raw virtio-blk block device, which is the tarball data blob of "
"the QEMU source tree, then configure/build it. Running \"make check\" is "
"also recommended."
msgstr ""

#: ../../../devel/testing.rst:782
msgid "Image fuzzer testing"
msgstr ""

#: ../../../devel/testing.rst:784
msgid ""
"An image fuzzer was added to exercise format drivers. Currently only qcow2 "
"is supported. To start the fuzzer, run"
msgstr ""

#: ../../../devel/testing.rst:787
msgid ""
"tests/image-fuzzer/runner.py -c '[[\"qemu-img\", \"info\", \"$test_img\"]]' /"
"tmp/test qcow2"
msgstr ""

#: ../../../devel/testing.rst:791
msgid ""
"Alternatively, some command different from ``qemu-img info`` can be tested, "
"by changing the ``-c`` option."
msgstr ""

#: ../../../devel/testing.rst:795
msgid "Integration tests using the Avocado Framework"
msgstr ""

#: ../../../devel/testing.rst:797
msgid ""
"The ``tests/avocado`` directory hosts integration tests. They're usually "
"higher level tests, and may interact with external resources and with "
"various guest operating systems."
msgstr ""

#: ../../../devel/testing.rst:801
msgid ""
"These tests are written using the Avocado Testing Framework (which must be "
"installed separately) in conjunction with a the ``avocado_qemu.Test`` class, "
"implemented at ``tests/avocado/avocado_qemu``."
msgstr ""

#: ../../../devel/testing.rst:805
msgid "Tests based on ``avocado_qemu.Test`` can easily:"
msgstr ""

#: ../../../devel/testing.rst:807
msgid ""
"Customize the command line arguments given to the convenience ``self.vm`` "
"attribute (a QEMUMachine instance)"
msgstr ""

#: ../../../devel/testing.rst:810
msgid ""
"Interact with the QEMU monitor, send QMP commands and check their results"
msgstr ""

#: ../../../devel/testing.rst:813
msgid ""
"Interact with the guest OS, using the convenience console device (which may "
"be useful to assert the effectiveness and correctness of command line "
"arguments or QMP commands)"
msgstr ""

#: ../../../devel/testing.rst:817
msgid ""
"Interact with external data files that accompany the test itself (see ``self."
"get_data()``)"
msgstr ""

#: ../../../devel/testing.rst:820
msgid ""
"Download (and cache) remote data files, such as firmware and kernel images"
msgstr ""

#: ../../../devel/testing.rst:823
msgid ""
"Have access to a library of guest OS images (by means of the ``avocado.utils."
"vmimage`` library)"
msgstr ""

#: ../../../devel/testing.rst:826
msgid ""
"Make use of various other test related utilities available at the test class "
"itself and at the utility library:"
msgstr ""

#: ../../../devel/testing.rst:829
msgid ""
"http://avocado-framework.readthedocs.io/en/latest/api/test/avocado."
"html#avocado.Test"
msgstr ""

#: ../../../devel/testing.rst:830
msgid ""
"http://avocado-framework.readthedocs.io/en/latest/api/utils/avocado.utils."
"html"
msgstr ""

#: ../../../devel/testing.rst:833
msgid "Running tests"
msgstr ""

#: ../../../devel/testing.rst:835
msgid "You can run the avocado tests simply by executing:"
msgstr ""

#: ../../../devel/testing.rst:837
msgid "make check-avocado"
msgstr ""

#: ../../../devel/testing.rst:841
msgid ""
"This involves the automatic creation of Python virtual environment within "
"the build tree (at ``tests/venv``) which will have all the right "
"dependencies, and will save tests results also within the build tree (at "
"``tests/results``)."
msgstr ""

#: ../../../devel/testing.rst:846
msgid ""
"Note: the build environment must be using a Python 3 stack, and have the "
"``venv`` and ``pip`` packages installed.  If necessary, make sure "
"``configure`` is called with ``--python=`` and that those modules are "
"available.  On Debian and Ubuntu based systems, depending on the specific "
"version, they may be on packages named ``python3-venv`` and ``python3-pip``."
msgstr ""

#: ../../../devel/testing.rst:853
msgid ""
"It is also possible to run tests based on tags using the ``make check-"
"avocado`` command and the ``AVOCADO_TAGS`` environment variable:"
msgstr ""

#: ../../../devel/testing.rst:857
msgid "make check-avocado AVOCADO_TAGS=quick"
msgstr ""

#: ../../../devel/testing.rst:861
msgid ""
"Note that tags separated with commas have an AND behavior, while tags "
"separated by spaces have an OR behavior. For more information on Avocado "
"tags, see:"
msgstr ""

#: ../../../devel/testing.rst:865
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/user/chapters/tags."
"html"
msgstr ""

#: ../../../devel/testing.rst:867
msgid ""
"To run a single test file, a couple of them, or a test within a file using "
"the ``make check-avocado`` command, set the ``AVOCADO_TESTS`` environment "
"variable with the test files or test names. To run all tests from a single "
"file, use:"
msgstr ""

#: ../../../devel/testing.rst:872
msgid "make check-avocado AVOCADO_TESTS=$FILEPATH"
msgstr ""

#: ../../../devel/testing.rst:876
msgid "The same is valid to run tests from multiple test files:"
msgstr ""

#: ../../../devel/testing.rst:878
msgid "make check-avocado AVOCADO_TESTS='$FILEPATH1 $FILEPATH2'"
msgstr ""

#: ../../../devel/testing.rst:882
msgid "To run a single test within a file, use:"
msgstr ""

#: ../../../devel/testing.rst:884
msgid "make check-avocado AVOCADO_TESTS=$FILEPATH:$TESTCLASS.$TESTNAME"
msgstr ""

#: ../../../devel/testing.rst:888
msgid "The same is valid to run single tests from multiple test files:"
msgstr ""

#: ../../../devel/testing.rst:890
msgid ""
"make check-avocado AVOCADO_TESTS='$FILEPATH1:$TESTCLASS1.$TESTNAME1 "
"$FILEPATH2:$TESTCLASS2.$TESTNAME2'"
msgstr ""

#: ../../../devel/testing.rst:894
msgid ""
"The scripts installed inside the virtual environment may be used without an "
"\"activation\".  For instance, the Avocado test runner may be invoked by "
"running:"
msgstr ""

#: ../../../devel/testing.rst:898
msgid "tests/venv/bin/avocado run $OPTION1 $OPTION2 tests/avocado/"
msgstr ""

#: ../../../devel/testing.rst:902
msgid ""
"Note that if ``make check-avocado`` was not executed before, it is possible "
"to create the Python virtual environment with the dependencies needed "
"running:"
msgstr ""

#: ../../../devel/testing.rst:906
msgid "make check-venv"
msgstr ""

#: ../../../devel/testing.rst:910
msgid ""
"It is also possible to run tests from a single file or a single test within "
"a test file. To run tests from a single file within the build tree, use:"
msgstr ""

#: ../../../devel/testing.rst:913
msgid "tests/venv/bin/avocado run tests/avocado/$TESTFILE"
msgstr ""

#: ../../../devel/testing.rst:917
msgid "To run a single test within a test file, use:"
msgstr ""

#: ../../../devel/testing.rst:919
msgid "tests/venv/bin/avocado run tests/avocado/$TESTFILE:$TESTCLASS.$TESTNAME"
msgstr ""

#: ../../../devel/testing.rst:923
msgid ""
"Valid test names are visible in the output from any previous execution of "
"Avocado or ``make check-avocado``, and can also be queried using:"
msgstr ""

#: ../../../devel/testing.rst:926
msgid "tests/venv/bin/avocado list tests/avocado"
msgstr ""

#: ../../../devel/testing.rst:931
msgid "Manual Installation"
msgstr ""

#: ../../../devel/testing.rst:933
msgid "To manually install Avocado and its dependencies, run:"
msgstr ""

#: ../../../devel/testing.rst:935
msgid "pip install --user avocado-framework"
msgstr ""

#: ../../../devel/testing.rst:939
msgid "Alternatively, follow the instructions on this link:"
msgstr ""

#: ../../../devel/testing.rst:941
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/user/chapters/"
"installing.html"
msgstr ""

#: ../../../devel/testing.rst:944
msgid "Overview"
msgstr ""

#: ../../../devel/testing.rst:946
msgid ""
"The ``tests/avocado/avocado_qemu`` directory provides the ``avocado_qemu`` "
"Python module, containing the ``avocado_qemu.Test`` class.  Here's a simple "
"usage example:"
msgstr ""

#: ../../../devel/testing.rst:950
msgid ""
"from avocado_qemu import QemuSystemTest\n"
"\n"
"\n"
"class Version(QemuSystemTest):\n"
"    \"\"\"\n"
"    :avocado: tags=quick\n"
"    \"\"\"\n"
"    def test_qmp_human_info_version(self):\n"
"        self.vm.launch()\n"
"        res = self.vm.command('human-monitor-command',\n"
"                              command_line='info version')\n"
"        self.assertRegexpMatches(res, r'^(\\d+\\.\\d+\\.\\d)')"
msgstr ""

#: ../../../devel/testing.rst:965
msgid "To execute your test, run:"
msgstr ""

#: ../../../devel/testing.rst:967
msgid "avocado run version.py"
msgstr ""

#: ../../../devel/testing.rst:971
msgid ""
"Tests may be classified according to a convention by using docstring "
"directives such as ``:avocado: tags=TAG1,TAG2``.  To run all tests in the "
"current directory, tagged as \"quick\", run:"
msgstr ""

#: ../../../devel/testing.rst:975
msgid "avocado run -t quick ."
msgstr ""

#: ../../../devel/testing.rst:980
msgid "The ``avocado_qemu.Test`` base test class"
msgstr ""

#: ../../../devel/testing.rst:982
msgid ""
"The ``avocado_qemu.Test`` class has a number of characteristics that are "
"worth being mentioned right away."
msgstr ""

#: ../../../devel/testing.rst:985
msgid ""
"First of all, it attempts to give each test a ready to use QEMUMachine "
"instance, available at ``self.vm``.  Because many tests will tweak the QEMU "
"command line, launching the QEMUMachine (by using ``self.vm.launch()``) is "
"left to the test writer."
msgstr ""

#: ../../../devel/testing.rst:990
msgid ""
"The base test class has also support for tests with more than one "
"QEMUMachine. The way to get machines is through the ``self.get_vm()`` method "
"which will return a QEMUMachine instance. The ``self.get_vm()`` method "
"accepts arguments that will be passed to the QEMUMachine creation and also "
"an optional ``name`` attribute so you can identify a specific machine and "
"get it more than once through the tests methods. A simple and hypothetical "
"example follows:"
msgstr ""

#: ../../../devel/testing.rst:998
msgid ""
"from avocado_qemu import QemuSystemTest\n"
"\n"
"\n"
"class MultipleMachines(QemuSystemTest):\n"
"    def test_multiple_machines(self):\n"
"        first_machine = self.get_vm()\n"
"        second_machine = self.get_vm()\n"
"        self.get_vm(name='third_machine').launch()\n"
"\n"
"        first_machine.launch()\n"
"        second_machine.launch()\n"
"\n"
"        first_res = first_machine.command(\n"
"            'human-monitor-command',\n"
"            command_line='info version')\n"
"\n"
"        second_res = second_machine.command(\n"
"            'human-monitor-command',\n"
"            command_line='info version')\n"
"\n"
"        third_res = self.get_vm(name='third_machine').command(\n"
"            'human-monitor-command',\n"
"            command_line='info version')\n"
"\n"
"        self.assertEquals(first_res, second_res, third_res)"
msgstr ""

#: ../../../devel/testing.rst:1026
msgid ""
"At test \"tear down\", ``avocado_qemu.Test`` handles all the QEMUMachines "
"shutdown."
msgstr ""

#: ../../../devel/testing.rst:1030
msgid "The ``avocado_qemu.LinuxTest`` base test class"
msgstr ""

#: ../../../devel/testing.rst:1032
msgid ""
"The ``avocado_qemu.LinuxTest`` is further specialization of the "
"``avocado_qemu.Test`` class, so it contains all the characteristics of the "
"later plus some extra features."
msgstr ""

#: ../../../devel/testing.rst:1036
msgid ""
"First of all, this base class is intended for tests that need to interact "
"with a fully booted and operational Linux guest.  At this time, it uses a "
"Fedora 31 guest image.  The most basic example looks like this:"
msgstr ""

#: ../../../devel/testing.rst:1041
msgid ""
"from avocado_qemu import LinuxTest\n"
"\n"
"\n"
"class SomeTest(LinuxTest):\n"
"\n"
"    def test(self):\n"
"        self.launch_and_wait()\n"
"        self.ssh_command('some_command_to_be_run_in_the_guest')"
msgstr ""

#: ../../../devel/testing.rst:1052
msgid ""
"Please refer to tests that use ``avocado_qemu.LinuxTest`` under ``tests/"
"avocado`` for more examples."
msgstr ""

#: ../../../devel/testing.rst:1056
msgid "QEMUMachine"
msgstr ""

#: ../../../devel/testing.rst:1058
msgid ""
"The QEMUMachine API is already widely used in the Python iotests, device-"
"crash-test and other Python scripts.  It's a wrapper around the execution of "
"a QEMU binary, giving its users:"
msgstr ""

#: ../../../devel/testing.rst:1062
msgid ""
"the ability to set command line arguments to be given to the QEMU binary"
msgstr ""

#: ../../../devel/testing.rst:1065
msgid ""
"a ready to use QMP connection and interface, which can be used to send "
"commands and inspect its results, as well as asynchronous events"
msgstr ""

#: ../../../devel/testing.rst:1069
msgid ""
"convenience methods to set commonly used command line arguments in a more "
"succinct and intuitive way"
msgstr ""

#: ../../../devel/testing.rst:1073
msgid "QEMU binary selection"
msgstr ""

#: ../../../devel/testing.rst:1075
msgid ""
"The QEMU binary used for the ``self.vm`` QEMUMachine instance will primarily "
"depend on the value of the ``qemu_bin`` parameter.  If it's not explicitly "
"set, its default value will be the result of a dynamic probe in the same "
"source tree.  A suitable binary will be one that targets the architecture "
"matching host machine."
msgstr ""

#: ../../../devel/testing.rst:1081
msgid ""
"Based on this description, test writers will usually rely on one of the "
"following approaches:"
msgstr ""

#: ../../../devel/testing.rst:1084
msgid "Set ``qemu_bin``, and use the given binary"
msgstr ""

#: ../../../devel/testing.rst:1086
msgid ""
"Do not set ``qemu_bin``, and use a QEMU binary named like \"qemu-system-"
"${arch}\", either in the current working directory, or in the current source "
"tree."
msgstr ""

#: ../../../devel/testing.rst:1090
msgid ""
"The resulting ``qemu_bin`` value will be preserved in the ``avocado_qemu."
"Test`` as an attribute with the same name."
msgstr ""

#: ../../../devel/testing.rst:1094
msgid "Attribute reference"
msgstr ""

#: ../../../devel/testing.rst:1097 ../../../devel/testing.rst:1204
msgid "Test"
msgstr ""

#: ../../../devel/testing.rst:1099
msgid ""
"Besides the attributes and methods that are part of the base ``avocado."
"Test`` class, the following attributes are available on any ``avocado_qemu."
"Test`` instance."
msgstr ""

#: ../../../devel/testing.rst:1104
msgid "vm"
msgstr ""

#: ../../../devel/testing.rst:1106
msgid ""
"A QEMUMachine instance, initially configured according to the given "
"``qemu_bin`` parameter."
msgstr ""

#: ../../../devel/testing.rst:1110 ../../../devel/testing.rst:1207
msgid "arch"
msgstr ""

#: ../../../devel/testing.rst:1112
msgid ""
"The architecture can be used on different levels of the stack, e.g. by the "
"framework or by the test itself.  At the framework level, it will currently "
"influence the selection of a QEMU binary (when one is not explicitly given)."
msgstr ""

#: ../../../devel/testing.rst:1117
msgid ""
"Tests are also free to use this attribute value, for their own needs. A test "
"may, for instance, use the same value when selecting the architecture of a "
"kernel or disk image to boot a VM with."
msgstr ""

#: ../../../devel/testing.rst:1121
msgid ""
"The ``arch`` attribute will be set to the test parameter of the same name.  "
"If one is not given explicitly, it will either be set to ``None``, or, if "
"the test is tagged with one (and only one) ``:avocado: tags=arch:VALUE`` "
"tag, it will be set to ``VALUE``."
msgstr ""

#: ../../../devel/testing.rst:1127 ../../../devel/testing.rst:1220
msgid "cpu"
msgstr ""

#: ../../../devel/testing.rst:1129 ../../../devel/testing.rst:1222
msgid ""
"The cpu model that will be set to all QEMUMachine instances created by the "
"test."
msgstr ""

#: ../../../devel/testing.rst:1132
msgid ""
"The ``cpu`` attribute will be set to the test parameter of the same name. If "
"one is not given explicitly, it will either be set to ``None ``, or, if the "
"test is tagged with one (and only one) ``:avocado: tags=cpu:VALUE`` tag, it "
"will be set to ``VALUE``."
msgstr ""

#: ../../../devel/testing.rst:1138 ../../../devel/testing.rst:1226
msgid "machine"
msgstr ""

#: ../../../devel/testing.rst:1140 ../../../devel/testing.rst:1228
msgid ""
"The machine type that will be set to all QEMUMachine instances created by "
"the test."
msgstr ""

#: ../../../devel/testing.rst:1143
msgid ""
"The ``machine`` attribute will be set to the test parameter of the same "
"name.  If one is not given explicitly, it will either be set to ``None``, "
"or, if the test is tagged with one (and only one) ``:avocado: tags=machine:"
"VALUE`` tag, it will be set to ``VALUE``."
msgstr ""

#: ../../../devel/testing.rst:1149 ../../../devel/testing.rst:1232
msgid "qemu_bin"
msgstr ""

#: ../../../devel/testing.rst:1151
msgid ""
"The preserved value of the ``qemu_bin`` parameter or the result of the "
"dynamic probe for a QEMU binary in the current working directory or source "
"tree."
msgstr ""

#: ../../../devel/testing.rst:1156 ../../../devel/testing.rst:1237
msgid "LinuxTest"
msgstr ""

#: ../../../devel/testing.rst:1158
msgid ""
"Besides the attributes present on the ``avocado_qemu.Test`` base class, the "
"``avocado_qemu.LinuxTest`` adds the following attributes:"
msgstr ""

#: ../../../devel/testing.rst:1162 ../../../devel/testing.rst:1243
msgid "distro"
msgstr ""

#: ../../../devel/testing.rst:1164 ../../../devel/testing.rst:1245
msgid ""
"The name of the Linux distribution used as the guest image for the test.  "
"The name should match the **Provider** column on the list of images "
"supported by the avocado.utils.vmimage library:"
msgstr ""

#: ../../../devel/testing.rst:1168 ../../../devel/testing.rst:1177
#: ../../../devel/testing.rst:1249 ../../../devel/testing.rst:1258
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/writer/libs/"
"vmimage.html#supported-images"
msgstr ""

#: ../../../devel/testing.rst:1171 ../../../devel/testing.rst:1252
msgid "distro_version"
msgstr ""

#: ../../../devel/testing.rst:1173 ../../../devel/testing.rst:1254
msgid ""
"The version of the Linux distribution as the guest image for the test.  The "
"name should match the **Version** column on the list of images supported by "
"the avocado.utils.vmimage library:"
msgstr ""

#: ../../../devel/testing.rst:1180 ../../../devel/testing.rst:1261
msgid "distro_checksum"
msgstr ""

#: ../../../devel/testing.rst:1182 ../../../devel/testing.rst:1263
msgid "The sha256 hash of the guest image file used for the test."
msgstr ""

#: ../../../devel/testing.rst:1184
msgid ""
"If this value is not set in the code or by a test parameter (with the same "
"name), no validation on the integrity of the image will be performed."
msgstr ""

#: ../../../devel/testing.rst:1189
msgid "Parameter reference"
msgstr ""

#: ../../../devel/testing.rst:1191
msgid ""
"To understand how Avocado parameters are accessed by tests, and how they can "
"be passed to tests, please refer to::"
msgstr ""

#: ../../../devel/testing.rst:1194
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/writer/chapters/"
"writing.html#accessing-test-parameters"
msgstr ""

#: ../../../devel/testing.rst:1196
msgid ""
"Parameter values can be easily seen in the log files, and will look like the "
"following:"
msgstr ""

#: ../../../devel/testing.rst:1199
msgid ""
"PARAMS (key=qemu_bin, path=*, default=./qemu-system-x86_64) => './qemu-"
"system-x86_64"
msgstr ""

#: ../../../devel/testing.rst:1209
msgid ""
"The architecture that will influence the selection of a QEMU binary (when "
"one is not explicitly given)."
msgstr ""

#: ../../../devel/testing.rst:1212
msgid ""
"Tests are also free to use this parameter value, for their own needs. A test "
"may, for instance, use the same value when selecting the architecture of a "
"kernel or disk image to boot a VM with."
msgstr ""

#: ../../../devel/testing.rst:1216
msgid ""
"This parameter has a direct relation with the ``arch`` attribute.  If not "
"given, it will default to None."
msgstr ""

#: ../../../devel/testing.rst:1234
msgid "The exact QEMU binary to be used on QEMUMachine."
msgstr ""

#: ../../../devel/testing.rst:1239
msgid ""
"Besides the parameters present on the ``avocado_qemu.Test`` base class, the "
"``avocado_qemu.LinuxTest`` adds the following parameters:"
msgstr ""

#: ../../../devel/testing.rst:1265
msgid ""
"If this value is not set in the code or by this parameter no validation on "
"the integrity of the image will be performed."
msgstr ""

#: ../../../devel/testing.rst:1269
msgid "Skipping tests"
msgstr ""

#: ../../../devel/testing.rst:1271
msgid ""
"The Avocado framework provides Python decorators which allow for easily skip "
"tests running under certain conditions. For example, on the lack of a binary "
"on the test system or when the running environment is a CI system. For "
"further information about those decorators, please refer to::"
msgstr ""

#: ../../../devel/testing.rst:1276
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/writer/chapters/"
"writing.html#skipping-tests"
msgstr ""

#: ../../../devel/testing.rst:1278
msgid ""
"While the conditions for skipping tests are often specifics of each one, "
"there are recurring scenarios identified by the QEMU developers and the use "
"of environment variables became a kind of standard way to enable/disable "
"tests."
msgstr ""

#: ../../../devel/testing.rst:1282
msgid "Here is a list of the most used variables:"
msgstr ""

#: ../../../devel/testing.rst:1285
msgid "AVOCADO_ALLOW_LARGE_STORAGE"
msgstr ""

#: ../../../devel/testing.rst:1286
msgid ""
"Tests which are going to fetch or produce assets considered *large* are not "
"going to run unless that ``AVOCADO_ALLOW_LARGE_STORAGE=1`` is exported on "
"the environment."
msgstr ""

#: ../../../devel/testing.rst:1290
msgid ""
"The definition of *large* is a bit arbitrary here, but it usually means an "
"asset which occupies at least 1GB of size on disk when uncompressed."
msgstr ""

#: ../../../devel/testing.rst:1294
msgid "AVOCADO_ALLOW_UNTRUSTED_CODE"
msgstr ""

#: ../../../devel/testing.rst:1295
msgid ""
"There are tests which will boot a kernel image or firmware that can be "
"considered not safe to run on the developer's workstation, thus they are "
"skipped by default. The definition of *not safe* is also arbitrary but "
"usually it means a blob which either its source or build process aren't "
"public available."
msgstr ""

#: ../../../devel/testing.rst:1301
msgid ""
"You should export ``AVOCADO_ALLOW_UNTRUSTED_CODE=1`` on the environment in "
"order to allow tests which make use of those kind of assets."
msgstr ""

#: ../../../devel/testing.rst:1305
msgid "AVOCADO_TIMEOUT_EXPECTED"
msgstr ""

#: ../../../devel/testing.rst:1306
msgid ""
"The Avocado framework has a timeout mechanism which interrupts tests to "
"avoid the test suite of getting stuck. The timeout value can be set via test "
"parameter or property defined in the test class, for further details::"
msgstr ""

#: ../../../devel/testing.rst:1310
msgid ""
"https://avocado-framework.readthedocs.io/en/latest/guides/writer/chapters/"
"writing.html#setting-a-test-timeout"
msgstr ""

#: ../../../devel/testing.rst:1312
msgid ""
"Even though the timeout can be set by the test developer, there are some "
"tests that may not have a well-defined limit of time to finish under certain "
"conditions. For example, tests that take longer to execute when QEMU is "
"compiled with debug flags. Therefore, the ``AVOCADO_TIMEOUT_EXPECTED`` "
"variable has been used to determine whether those tests should run or not."
msgstr ""

#: ../../../devel/testing.rst:1319
msgid "GITLAB_CI"
msgstr ""

#: ../../../devel/testing.rst:1320
msgid ""
"A number of tests are flagged to not run on the GitLab CI. Usually because "
"they proved to the flaky or there are constraints on the CI environment "
"which would make them fail. If you encounter a similar situation then use "
"that variable as shown on the code snippet below to skip the test:"
msgstr ""

#: ../../../devel/testing.rst:1325
msgid ""
"@skipIf(os.getenv('GITLAB_CI'), 'Running on GitLab')\n"
"def test(self):\n"
"    do_something()"
msgstr ""

#: ../../../devel/testing.rst:1332
msgid "Uninstalling Avocado"
msgstr ""

#: ../../../devel/testing.rst:1334
msgid ""
"If you've followed the manual installation instructions above, you can "
"easily uninstall Avocado.  Start by listing the packages you have installed::"
msgstr ""

#: ../../../devel/testing.rst:1338
msgid "pip list --user"
msgstr ""

#: ../../../devel/testing.rst:1340
msgid "And remove any package you want with::"
msgstr ""

#: ../../../devel/testing.rst:1342
msgid "pip uninstall <package_name>"
msgstr ""

#: ../../../devel/testing.rst:1344
msgid ""
"If you've used ``make check-avocado``, the Python virtual environment where "
"Avocado is installed will be cleaned up as part of ``make check-clean``."
msgstr ""

#: ../../../devel/testing.rst:1350
msgid "Testing with \"make check-tcg\""
msgstr ""

#: ../../../devel/testing.rst:1352
msgid ""
"The check-tcg tests are intended for simple smoke tests of both linux-user "
"and softmmu TCG functionality. However to build test programs for guest "
"targets you need to have cross compilers available. If your distribution "
"supports cross compilers you can do something as simple as::"
msgstr ""

#: ../../../devel/testing.rst:1358
msgid "apt install gcc-aarch64-linux-gnu"
msgstr ""

#: ../../../devel/testing.rst:1360
msgid ""
"The configure script will automatically pick up their presence. Sometimes "
"compilers have slightly odd names so the availability of them can be "
"prompted by passing in the appropriate configure option for the architecture "
"in question, for example::"
msgstr ""

#: ../../../devel/testing.rst:1365
msgid "$(configure) --cross-cc-aarch64=aarch64-cc"
msgstr ""

#: ../../../devel/testing.rst:1367
msgid ""
"There is also a ``--cross-cc-cflags-ARCH`` flag in case additional compiler "
"flags are needed to build for a given target."
msgstr ""

#: ../../../devel/testing.rst:1370
msgid ""
"If you have the ability to run containers as the user the build system will "
"automatically use them where no system compiler is available. For "
"architectures where we also support building QEMU we will generally use the "
"same container to build tests. However there are a number of additional "
"containers defined that have a minimal cross-build environment that is only "
"suitable for building test cases. Sometimes we may use a bleeding edge "
"distribution for compiler features needed for test cases that aren't yet in "
"the LTS distros we support for QEMU itself."
msgstr ""

#: ../../../devel/testing.rst:1380
msgid "See :ref:`container-ref` for more details."
msgstr ""

#: ../../../devel/testing.rst:1383
msgid "Running subset of tests"
msgstr ""

#: ../../../devel/testing.rst:1385
msgid "You can build the tests for one architecture::"
msgstr ""

#: ../../../devel/testing.rst:1387
msgid "make build-tcg-tests-$TARGET"
msgstr ""

#: ../../../devel/testing.rst:1389
msgid "And run with::"
msgstr ""

#: ../../../devel/testing.rst:1391
msgid "make run-tcg-tests-$TARGET"
msgstr ""

#: ../../../devel/testing.rst:1393
msgid ""
"Adding ``V=1`` to the invocation will show the details of how to invoke QEMU "
"for the test which is useful for debugging tests."
msgstr ""

#: ../../../devel/testing.rst:1397
msgid "TCG test dependencies"
msgstr ""

#: ../../../devel/testing.rst:1399
msgid ""
"The TCG tests are deliberately very light on dependencies and are either "
"totally bare with minimal gcc lib support (for softmmu tests) or just glibc "
"(for linux-user tests). This is because getting a cross compiler to work "
"with additional libraries can be challenging."
msgstr ""

#: ../../../devel/testing.rst:1405
msgid "Other TCG Tests"
msgstr ""

#: ../../../devel/testing.rst:1407
msgid ""
"There are a number of out-of-tree test suites that are used for more "
"extensive testing of processor features."
msgstr ""

#: ../../../devel/testing.rst:1411
msgid "KVM Unit Tests"
msgstr ""

#: ../../../devel/testing.rst:1413
msgid ""
"The KVM unit tests are designed to run as a Guest OS under KVM but there is "
"no reason why they can't exercise the TCG as well. It provides a minimal OS "
"kernel with hooks for enabling the MMU as well as reporting test results via "
"a special device::"
msgstr ""

#: ../../../devel/testing.rst:1418
msgid "https://git.kernel.org/pub/scm/virt/kvm/kvm-unit-tests.git"
msgstr ""

#: ../../../devel/testing.rst:1421
msgid "Linux Test Project"
msgstr ""

#: ../../../devel/testing.rst:1423
msgid ""
"The LTP is focused on exercising the syscall interface of a Linux kernel. It "
"checks that syscalls behave as documented and strives to exercise as many "
"corner cases as possible. It is a useful test suite to run to exercise "
"QEMU's linux-user code::"
msgstr ""

#: ../../../devel/testing.rst:1428
msgid "https://linux-test-project.github.io/"
msgstr ""

#: ../../../devel/testing.rst:1431
msgid "GCC gcov support"
msgstr ""

#: ../../../devel/testing.rst:1433
msgid ""
"``gcov`` is a GCC tool to analyze the testing coverage by instrumenting the "
"tested code. To use it, configure QEMU with ``--enable-gcov`` option and "
"build. Then run the tests as usual."
msgstr ""

#: ../../../devel/testing.rst:1437
msgid ""
"If you want to gather coverage information on a single test the ``make clean-"
"gcda`` target can be used to delete any existing coverage information before "
"running a single test."
msgstr ""

#: ../../../devel/testing.rst:1441
msgid ""
"You can generate a HTML coverage report by executing ``make coverage-html`` "
"which will create ``meson-logs/coveragereport/index.html``."
msgstr ""

#: ../../../devel/testing.rst:1445
msgid ""
"Further analysis can be conducted by running the ``gcov`` command directly "
"on the various .gcda output files. Please read the ``gcov`` documentation "
"for more information."
msgstr ""
